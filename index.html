<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Compiler</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/theme/dracula.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/addon/hint/show-hint.min.css">
<style>
  body { font-family: sans-serif; background: #1e1e1e; color: #eee; display: flex; flex-direction: column; align-items: center; margin: 1em; gap: 1em; }
  h1 { color: #eee; }
  .tabs { display: flex; margin-bottom: 0.5em; overflow-x: auto; }
  .tab { padding: 0.5em 1em; cursor: pointer; background: #333; color: #eee; margin-right: 0.2em; border-radius: 4px 4px 0 0; flex: 1; text-align: center; }
  .tab.active { background: #444; border: 1px solid #666; border-bottom: none; }
  .window { border: 1px solid #666; border-radius: 0 0 8px 8px; background: #2e2e2e; width: 100%; max-width: 400px; height: 500px; box-shadow: 0 2px 8px rgba(0,0,0,0.4); display: none; flex-direction: column; }
  .window.active { display: flex; }
  .titlebar { background: #444; display: flex; align-items: center; padding: 0.3em 0.5em; border-bottom: 1px solid #666; border-top-left-radius: 8px; border-top-right-radius: 8px; }
  .titlebar .buttons { display: flex; gap: 0.3em; margin-right: 0.5em; }
  .titlebar .button { width: 12px; height: 12px; border-radius: 50%; }
  .red { background: #f66; }
  .yellow { background: #fc3; }
  .green { background: #3c3; }
  .address-bar { flex: 1; background: #555; border: 1px solid #666; border-radius: 4px; padding: 0.2em 0.5em; font-size: 0.8em; color: #eee; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .content { flex: 1; padding: 0.5em; }
  iframe { width: 100%; height: 100%; border: none; background: #1e1e1e; }
  button { margin: 0.3em; background: #444; color: #eee; border: 1px solid #666; border-radius: 4px; padding: 0.5em 1em; cursor: pointer; width: 80px; }
  button:hover { background: #555; }
  .status { font-weight: bold; color: #ccc; }
</style>
</head>
<body>

<h1>Compiler</h1>

<div class="tabs">
  <div class="tab active" onclick="showTab('indexEditor')">index.html</div>
  <div class="tab" onclick="showTab('cssEditor')">styles.css</div>
  <div class="tab" onclick="showTab('jsEditor')">script.js</div>
  <div class="tab" onclick="showTab('output')">Output</div>
</div>

<div class="window active" id="indexEditor">
  <div class="titlebar">
    <div class="buttons">
      <div class="button red"></div>
      <div class="button yellow"></div>
      <div class="button green"></div>
    </div>
    <div class="address-bar">https://editor.local/index.html</div>
  </div>
  <div class="content">
    <textarea id="indexCode"></textarea>
  </div>
</div>

<div class="window" id="cssEditor">
  <div class="titlebar">
    <div class="buttons">
      <div class="button red"></div>
      <div class="button yellow"></div>
      <div class="button green"></div>
    </div>
    <div class="address-bar">https://editor.local/styles.css</div>
  </div>
  <div class="content">
    <textarea id="cssCode"></textarea>
  </div>
</div>

<div class="window" id="jsEditor">
  <div class="titlebar">
    <div class="buttons">
      <div class="button red"></div>
      <div class="button yellow"></div>
      <div class="button green"></div>
    </div>
    <div class="address-bar">https://editor.local/script.js</div>
  </div>
  <div class="content">
    <textarea id="jsCode"></textarea>
  </div>
</div>

<div class="window" id="output">
  <div class="titlebar">
    <div class="buttons">
      <div class="button red"></div>
      <div class="button yellow"></div>
      <div class="button green"></div>
    </div>
    <div class="address-bar">https://output.local/</div>
  </div>
  <div class="content">
    <iframe id="outputWindow"></iframe>
  </div>
</div>

<div>
  <button onclick="runCode()">Run</button>
  <button onclick="pauseCode()">Pause</button>
  <button onclick="stopCode()">Stop</button>
  <button onclick="downloadCode()">Download</button>
  <button onclick="clearEditors()">Clear</button>
</div>

<div class="status" id="statusIndicator">Status: stopped</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/mode/htmlmixed/htmlmixed.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/addon/hint/show-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/addon/hint/html-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/addon/hint/css-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.14/addon/hint/javascript-hint.min.js"></script>

<script>
let indexEditor, cssEditor, jsEditor;
let runnerInterval;
let status = 'stopped';

window.onload = function() {
  indexEditor = CodeMirror.fromTextArea(document.getElementById('indexCode'), {
    lineNumbers: true,
    mode: "htmlmixed",
    theme: "dracula",
    extraKeys: { "Ctrl-Space": "autocomplete" }
  });
  cssEditor = CodeMirror.fromTextArea(document.getElementById('cssCode'), {
    lineNumbers: true,
    mode: "css",
    theme: "dracula",
    extraKeys: { "Ctrl-Space": "autocomplete" }
  });
  jsEditor = CodeMirror.fromTextArea(document.getElementById('jsCode'), {
    lineNumbers: true,
    mode: "javascript",
    theme: "dracula",
    extraKeys: { "Ctrl-Space": "autocomplete" }
  });

  indexEditor.setSize("100%", "600px");
  cssEditor.setSize("100%", "600px");
  jsEditor.setSize("100%", "600px");

  // Load saved content
  indexEditor.setValue(localStorage.getItem('code_index') || '');
  cssEditor.setValue(localStorage.getItem('code_css') || '');
  jsEditor.setValue(localStorage.getItem('code_js') || '');

  // Save on change
  indexEditor.on('change', () => localStorage.setItem('code_index', indexEditor.getValue()));
  cssEditor.on('change', () => localStorage.setItem('code_css', cssEditor.getValue()));
  jsEditor.on('change', () => localStorage.setItem('code_js', jsEditor.getValue()));
};

function showTab(tabId) {
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.window').forEach(win => win.classList.remove('active'));
  document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
  document.getElementById(tabId).classList.add('active');
}

function updateStatus(newStatus) {
  status = newStatus;
  document.getElementById('statusIndicator').textContent = 'Status: ' + status;
}

function runCode() {
  const html = indexEditor.getValue();
  const css = `<style>${cssEditor.getValue()}</style>`;
  const js = `<script>${jsEditor.getValue()}<\/script>`;
  const outputFrame = document.getElementById('outputWindow');
  outputFrame.srcdoc = html + css + js;
  clearInterval(runnerInterval);
  runnerInterval = setInterval(() => {
    if (!outputFrame.contentWindow) return;
    try {
      outputFrame.contentWindow.eval(jsEditor.getValue());
    } catch (e) {
      console.error(e);
    }
  }, 1000);
  updateStatus('running');
}

function pauseCode() {
  clearInterval(runnerInterval);
  const outputFrame = document.getElementById('outputWindow');
  const doc = outputFrame.contentDocument || outputFrame.contentWindow.document;
  const pauseMsg = doc.createElement('p');
  pauseMsg.style.color = 'red';
  pauseMsg.style.fontSize = '1.2em';
  pauseMsg.textContent = '⚠️ Code paused';
  doc.body.appendChild(pauseMsg);
  updateStatus('paused');
}

function stopCode() {
  clearInterval(runnerInterval);
  document.getElementById('outputWindow').srcdoc = '';
  updateStatus('stopped');
}

function downloadCode() {
  const zip = {
    'index.html': indexEditor.getValue(),
    'styles.css': cssEditor.getValue(),
    'script.js': jsEditor.getValue()
  };
  for (const file in zip) {
    const blob = new Blob([zip[file]], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = file;
    a.click();
    URL.revokeObjectURL(url);
  }
}

function clearEditors() {
  indexEditor.setValue('');
  cssEditor.setValue('');
  jsEditor.setValue('');
  localStorage.removeItem('code_index');
  localStorage.removeItem('code_css');
  localStorage.removeItem('code_js');
}
</script>

</body>
</html>
